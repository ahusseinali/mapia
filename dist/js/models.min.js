var app=app||{};app.models=app.models||{},function(){"use strict";app.models.mapStyles={grayscale:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}]}}();var app=app||{};app.models=app.models||{},function(){var e=function(e){e?(this.img=e.image_url,this.rating=e.rating_img_url,this.url=e.url,this.snippet=e.snippet_text,this.noData=""):this.noData=ko.observable("No Yelp Data Found")};app.models.yelp=e}();var app=app||{};app.models=app.models||{},function(){"use strict";var e=function(e,t){var a=e.geometry.location;this.id=e.place_id,this.latLng=a,this.name=e.name,this.address=e.vicinity,this.rating=e.rating,this.img="https://maps.googleapis.com/maps/api/streetview?size=350x250&heading=151.78&pitch=-0.76&location="+a.lat()+","+a.lng()+"&key="+googleMapsKey,this.types=[t],this.yelp=ko.observable(null),this.marker=null};e.prototype.setMarker=function(e){this.marker=e},e.prototype.hasYelpData=function(){return null!=this.yelp()},app.models.place=e}();var app=app||{};app.models=app.models||{},function(){"use strict";var e=function(e){this.yelp={url:"http://api.yelp.com/v2/search",consumerKey:yelpConsumerKey,consumerSecret:yelpConsumerSecret,accessToken:yelpAccessToken,accessTokenSecret:yelpAccessTokenSecret,serviceProvider:{signatureMethod:"HMAC-SHA1"}},this.places=[],this.selectedPlaces=ko.observableArray([]),this.currentPlace=ko.observable(null),this.mapModel=e};e.prototype.isPlaceSelected=function(e){return this.isAnyPlaceSelected()&&e.id==this.currentPlace().id},e.prototype.isAnyPlaceSelected=function(){return null!=this.currentPlace()},e.prototype.search=function(e){var t=this.places;this.currentPlace(null),this.places.forEach(function(e){e.marker.setVisible(!1)}),e&&(e=e.toLowerCase(),t=t.filter(function(t){return t.name.toLowerCase().indexOf(e)>-1||t.types.join(" ").toLowerCase().indexOf(e)>-1||t.address.toLowerCase().indexOf(e)>-1})),t.forEach(function(e){e.marker.setVisible(!0)}),this.selectedPlaces(t)},e.prototype.loadGooglePlaces=function(e){this.places.splice(0,this.places.length),this.placesService=new google.maps.places.PlacesService(app.mapObjects.map),this._addGooglePlaces(e,"store"),this._addGooglePlaces(e,"lodge"),this._addGooglePlaces(e,"restaurant"),this._addGooglePlaces(e,"grocery"),this._addGooglePlaces(e,"hospital"),this._addGooglePlaces(e,"park")},e.prototype._addGooglePlaces=function(e,t){var a={location:e,keyword:t,radius:"500"},s=this;s.placesService.nearbySearch(a,function(e){e.forEach(function(e){var a=s.places.filter(function(t){return t.id==e.place_id});if(a.length>0)a[0].types.push(t);else{var i=new app.models.place(e,t),o=s._createMarker(i);i.setMarker(o),s.places.push(i),s.selectedPlaces.push(i),app.mapObjects.bounds.extend(i.latLng),app.mapObjects.map.fitBounds(app.mapObjects.bounds)}})})},e.prototype._loadYelpDetails=function(e){var t=e.name,a=e.latLng.lat()+","+e.latLng.lng(),s=this,i=[];i.push(["term",t]),i.push(["ll",a]),i.push(["callback","cb"]),i.push(["oauth_consumer_key",s.yelp.consumerKey]),i.push(["oauth_consumer_secret",s.yelp.consumerSecret]),i.push(["oauth_token",s.yelp.accessToken]),i.push(["oauth_signature_method",s.yelp.serviceProvider.signatureMethod]);var o={action:s.yelp.url,method:"GET",parameters:i},p={consumerSecret:s.yelp.consumerSecret,tokenSecret:s.yelp.accessTokenSecret};OAuth.setTimestampAndNonce(o),OAuth.SignatureMethod.sign(o,p);var l=OAuth.getParameterMap(o.parameters);l.oauth_signature=OAuth.percentEncode(l.oauth_signature),$.ajax({url:o.action,data:l,cache:!0,dataType:"jsonp",jsonpCallback:"cb"}).done(function(t){if(t.businesses&&t.businesses.length>0){var a=new app.models.yelp(t.businesses[0]);e.yelp(a)}else e.yelp(new app.models.yelp(null))}).fail(function(t,a){e.yelp(new app.models.yelp(null)),e.yelp().noData("Failed to load Yelp Data")})},e.prototype._createMarker=function(e){var t=new google.maps.Marker({position:e.latLng,map:app.mapObjects.map}),a=this;return t.setIcon("img/"+e.types[0]+".png"),t.addListener("click",function(){a.mapModel.closeSideNav.call(a.mapModel),new google.maps.event.trigger(app.mapObjects.infowindow,"closeclick"),app.mapObjects.map.panTo(t.getPosition()),a._loadYelpDetails(e),a.currentPlace(e),t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null),app.mapObjects.infowindow.setContent(app.mapObjects.infobox.outerHTML),app.mapObjects.infowindow.open(app.mapObjects.map,t)},700)}),t},app.models.placesModel=e}();var app=app||{};app.models=app.models||{},function(){"use strict";var e=function(){this.center=ko.observable(new google.maps.LatLng(47.6163,-122.192)),this.styles=ko.observable(app.models.mapStyles.grayscale),this.places=new app.models.placesModel(this),this.sideNavVisible=ko.observable(!1)};e.prototype.search=function(e){this.places.search(e)},e.prototype.openSideNav=function(){this.sideNavVisible(!0)},e.prototype.closeSideNav=function(){this.sideNavVisible(!1)},app.models.mapModel=e}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hcC1zdHlsZXMuanMiLCJ5ZWxwLW1vZGVsLmpzIiwicGxhY2UtbW9kZWwuanMiLCJwbGFjZXMtbW9kZWwuanMiLCJtYXAtbW9kZWwuanMiXSwibmFtZXMiOlsiYXBwIiwibW9kZWxzIiwibWFwU3R5bGVzIiwiZ3JheXNjYWxlIiwiZmVhdHVyZVR5cGUiLCJzdHlsZXJzIiwic2F0dXJhdGlvbiIsImxpZ2h0bmVzcyIsInZpc2liaWxpdHkiLCJlbGVtZW50VHlwZSIsImh1ZSIsIlllbHBEZXRhaWxzIiwieWVscE9iaiIsInRoaXMiLCJpbWciLCJpbWFnZV91cmwiLCJyYXRpbmciLCJyYXRpbmdfaW1nX3VybCIsInVybCIsInNuaXBwZXQiLCJzbmlwcGV0X3RleHQiLCJub0RhdGEiLCJrbyIsIm9ic2VydmFibGUiLCJ5ZWxwIiwiUGxhY2UiLCJnb29nbGVQbGFjZSIsInR5cGUiLCJsb2NhdGlvbiIsImdlb21ldHJ5IiwiaWQiLCJwbGFjZV9pZCIsImxhdExuZyIsIm5hbWUiLCJhZGRyZXNzIiwidmljaW5pdHkiLCJsYXQiLCJsbmciLCJnb29nbGVNYXBzS2V5IiwidHlwZXMiLCJtYXJrZXIiLCJwcm90b3R5cGUiLCJzZXRNYXJrZXIiLCJoYXNZZWxwRGF0YSIsInBsYWNlIiwiUGxhY2VzTW9kZWwiLCJtYXBNb2RlbCIsImNvbnN1bWVyS2V5IiwieWVscENvbnN1bWVyS2V5IiwiY29uc3VtZXJTZWNyZXQiLCJ5ZWxwQ29uc3VtZXJTZWNyZXQiLCJhY2Nlc3NUb2tlbiIsInllbHBBY2Nlc3NUb2tlbiIsImFjY2Vzc1Rva2VuU2VjcmV0IiwieWVscEFjY2Vzc1Rva2VuU2VjcmV0Iiwic2VydmljZVByb3ZpZGVyIiwic2lnbmF0dXJlTWV0aG9kIiwicGxhY2VzIiwic2VsZWN0ZWRQbGFjZXMiLCJvYnNlcnZhYmxlQXJyYXkiLCJjdXJyZW50UGxhY2UiLCJpc1BsYWNlU2VsZWN0ZWQiLCJpc0FueVBsYWNlU2VsZWN0ZWQiLCJzZWFyY2giLCJrZXl3b3JkIiwiZmlsdGVyZWRQbGFjZXMiLCJmb3JFYWNoIiwic2V0VmlzaWJsZSIsInRvTG93ZXJDYXNlIiwiZmlsdGVyIiwiaW5kZXhPZiIsImpvaW4iLCJsb2FkR29vZ2xlUGxhY2VzIiwic3BsaWNlIiwibGVuZ3RoIiwicGxhY2VzU2VydmljZSIsImdvb2dsZSIsIm1hcHMiLCJQbGFjZXNTZXJ2aWNlIiwibWFwT2JqZWN0cyIsIm1hcCIsIl9hZGRHb29nbGVQbGFjZXMiLCJyZXF1ZXN0IiwicmFkaXVzIiwic2VsZiIsIm5lYXJieVNlYXJjaCIsInJlc3BvbnNlIiwiZXhpc3RpbmdQbGFjZSIsInB1c2giLCJuZXdQbGFjZSIsIm5ld01hcmtlciIsIl9jcmVhdGVNYXJrZXIiLCJib3VuZHMiLCJleHRlbmQiLCJmaXRCb3VuZHMiLCJfbG9hZFllbHBEZXRhaWxzIiwidGVybXMiLCJuZWFyIiwicGFyYW1ldGVycyIsIm1lc3NhZ2UiLCJhY3Rpb24iLCJtZXRob2QiLCJhY2Nlc3NvciIsInRva2VuU2VjcmV0IiwiT0F1dGgiLCJzZXRUaW1lc3RhbXBBbmROb25jZSIsIlNpZ25hdHVyZU1ldGhvZCIsInNpZ24iLCJwYXJhbWV0ZXJNYXAiLCJnZXRQYXJhbWV0ZXJNYXAiLCJvYXV0aF9zaWduYXR1cmUiLCJwZXJjZW50RW5jb2RlIiwiJCIsImFqYXgiLCJkYXRhIiwiY2FjaGUiLCJkYXRhVHlwZSIsImpzb25wQ2FsbGJhY2siLCJkb25lIiwiYnVzaW5lc3NlcyIsImZhaWwiLCJqcVhIUiIsInRleHRTdGF0dXMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsInNldEljb24iLCJhZGRMaXN0ZW5lciIsImNsb3NlU2lkZU5hdiIsImNhbGwiLCJldmVudCIsInRyaWdnZXIiLCJpbmZvd2luZG93IiwicGFuVG8iLCJnZXRQb3NpdGlvbiIsInNldEFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkJPVU5DRSIsInNldFRpbWVvdXQiLCJzZXRDb250ZW50IiwiaW5mb2JveCIsIm91dGVySFRNTCIsIm9wZW4iLCJwbGFjZXNNb2RlbCIsIk1hcE1vZGVs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QSxLQUFBQyxPQUFBRCxJQUFBQyxXQUVBLFdBQ0EsWUFFQSxJQUFBOEksR0FBQSxXQUNBbEksS0FBQW1JLE9BQUExSCxHQUFBQyxXQUFBLEdBQUFxRCxRQUFBQyxLQUFBb0UsT0FBQSxRQUFBLFdBQ0FwSSxLQUFBcUksT0FBQTVILEdBQUFDLFdBQUF2QixJQUFBQyxPQUFBQyxVQUFBQyxXQUNBVSxLQUFBNEMsT0FBQSxHQUFBekQsS0FBQUMsT0FBQTZJLFlBQUFqSSxNQUVBQSxLQUFBc0ksZUFBQTdILEdBQUFDLFlBQUEsR0FJQXdILEdBQUF0RyxVQUFBc0IsT0FBQSxTQUFBQyxHQUVBbkQsS0FBQTRDLE9BQUFNLE9BQUFDLElBR0ErRSxFQUFBdEcsVUFBQTJHLFlBQUEsV0FDQXZJLEtBQUFzSSxnQkFBQSxJQUdBSixFQUFBdEcsVUFBQXNGLGFBQUEsV0FDQWxILEtBQUFzSSxnQkFBQSxJQUlBbkosSUFBQUMsT0FBQTZDLFNBQUFpRyIsImZpbGUiOiJtb2RlbHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFwcCB8fCB7fTtcclxuYXBwLm1vZGVscyA9IGFwcC5tb2RlbHMgfHwge307XHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgLy8gQ3VzdG9tZSBzdHlsZXMgZm9yIGdvb2dsZSBtYXBzXHJcbiAgICBhcHAubW9kZWxzLm1hcFN0eWxlcyA9IHtcclxuICAgICAgICAvLyBUYWtlbiBmcm9tOiBodHRwczovL3NuYXp6eW1hcHMuY29tL3N0eWxlLzE1L3N1YnRsZS1ncmF5c2NhbGVcclxuICAgICAgICBncmF5c2NhbGU6IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOlwibGFuZHNjYXBlXCIsXHJcbiAgICAgICAgICAgICAgICBcInN0eWxlcnNcIjpbe1wic2F0dXJhdGlvblwiOi0xMDB9LHtcImxpZ2h0bmVzc1wiOjY1fSx7XCJ2aXNpYmlsaXR5XCI6XCJvblwifV1cclxuICAgICAgICAgICAgfSx7XHJcbiAgICAgICAgICAgICAgICBcImZlYXR1cmVUeXBlXCI6XCJwb2lcIixcclxuICAgICAgICAgICAgICAgIFwic3R5bGVyc1wiOlt7XCJzYXR1cmF0aW9uXCI6LTEwMH0se1wibGlnaHRuZXNzXCI6NTF9LHtcInZpc2liaWxpdHlcIjpcInNpbXBsaWZpZWRcIn1dXHJcbiAgICAgICAgICAgIH0se1xyXG4gICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOlwicm9hZC5oaWdod2F5XCIsXHJcbiAgICAgICAgICAgICAgICBcInN0eWxlcnNcIjpbe1wic2F0dXJhdGlvblwiOi0xMDB9LHtcInZpc2liaWxpdHlcIjpcInNpbXBsaWZpZWRcIn1dXHJcbiAgICAgICAgICAgIH0se1xyXG4gICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOlwicm9hZC5hcnRlcmlhbFwiLFxyXG4gICAgICAgICAgICAgICAgXCJzdHlsZXJzXCI6W3tcInNhdHVyYXRpb25cIjotMTAwfSx7XCJsaWdodG5lc3NcIjozMH0se1widmlzaWJpbGl0eVwiOlwib25cIn1dXHJcbiAgICAgICAgICAgIH0se1xyXG4gICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOlwicm9hZC5sb2NhbFwiLFxyXG4gICAgICAgICAgICAgICAgXCJzdHlsZXJzXCI6W3tcInNhdHVyYXRpb25cIjotMTAwfSx7XCJsaWdodG5lc3NcIjo0MH0se1widmlzaWJpbGl0eVwiOlwib25cIn1dXHJcbiAgICAgICAgICAgIH0se1xyXG4gICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOlwidHJhbnNpdFwiLFxyXG4gICAgICAgICAgICAgICAgXCJzdHlsZXJzXCI6W3tcInNhdHVyYXRpb25cIjotMTAwfSx7XCJ2aXNpYmlsaXR5XCI6XCJzaW1wbGlmaWVkXCJ9XVxyXG4gICAgICAgICAgICB9LHtcclxuICAgICAgICAgICAgICAgIFwiZmVhdHVyZVR5cGVcIjpcImFkbWluaXN0cmF0aXZlLnByb3ZpbmNlXCIsXHJcbiAgICAgICAgICAgICAgICBcInN0eWxlcnNcIjpbe1widmlzaWJpbGl0eVwiOlwib2ZmXCJ9XVxyXG4gICAgICAgICAgICB9LHtcclxuICAgICAgICAgICAgICAgIFwiZmVhdHVyZVR5cGVcIjpcIndhdGVyXCIsXHJcbiAgICAgICAgICAgICAgICBcImVsZW1lbnRUeXBlXCI6XCJsYWJlbHNcIixcclxuICAgICAgICAgICAgICAgIFwic3R5bGVyc1wiOlt7XCJ2aXNpYmlsaXR5XCI6XCJvblwifSx7XCJsaWdodG5lc3NcIjotMjV9LHtcInNhdHVyYXRpb25cIjotMTAwfV1cclxuICAgICAgICAgICAgfSx7XHJcbiAgICAgICAgICAgICAgICBcImZlYXR1cmVUeXBlXCI6XCJ3YXRlclwiLFxyXG4gICAgICAgICAgICAgICAgXCJlbGVtZW50VHlwZVwiOlwiZ2VvbWV0cnlcIixcclxuICAgICAgICAgICAgICAgIFwic3R5bGVyc1wiOlt7XCJodWVcIjpcIiNmZmZmMDBcIn0se1wibGlnaHRuZXNzXCI6LTI1fSx7XCJzYXR1cmF0aW9uXCI6LTk3fV1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIF1cclxuICAgIH07XHJcbn0pKCk7IiwidmFyIGFwcCA9IGFwcCB8fCB7fTtcclxuYXBwLm1vZGVscyA9IGFwcC5tb2RlbHMgfHwge307XHJcblxyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICB2YXIgWWVscERldGFpbHMgPSBmdW5jdGlvbih5ZWxwT2JqKSB7XHJcbiAgICAgICAgaWYoeWVscE9iaikge1xyXG4gICAgICAgICAgICB0aGlzLmltZyA9IHllbHBPYmouaW1hZ2VfdXJsO1xyXG4gICAgICAgICAgICB0aGlzLnJhdGluZyA9IHllbHBPYmoucmF0aW5nX2ltZ191cmw7XHJcbiAgICAgICAgICAgIHRoaXMudXJsID0geWVscE9iai51cmw7XHJcbiAgICAgICAgICAgIHRoaXMuc25pcHBldCA9IHllbHBPYmouc25pcHBldF90ZXh0O1xyXG4gICAgICAgICAgICB0aGlzLm5vRGF0YSA9ICcnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9EYXRhID0ga28ub2JzZXJ2YWJsZSgnTm8gWWVscCBEYXRhIEZvdW5kJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBhcHAubW9kZWxzLnllbHAgPSBZZWxwRGV0YWlscztcclxufSkoKTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xyXG5hcHAubW9kZWxzID0gYXBwLm1vZGVscyB8fCB7fTtcclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICAvLyBJbml0aWFsaXplZCB1c2luZyBHb29nbGUgUGxhY2VzIFJlc3VsdFxyXG4gICAgdmFyIFBsYWNlID0gZnVuY3Rpb24oZ29vZ2xlUGxhY2UsIHR5cGUpIHtcclxuICAgICAgICB2YXIgbG9jYXRpb24gPSBnb29nbGVQbGFjZS5nZW9tZXRyeS5sb2NhdGlvbjtcclxuICAgICAgICB0aGlzLmlkID0gZ29vZ2xlUGxhY2UucGxhY2VfaWQ7XHJcbiAgICAgICAgdGhpcy5sYXRMbmcgPSBsb2NhdGlvbjtcclxuICAgICAgICB0aGlzLm5hbWUgPSBnb29nbGVQbGFjZS5uYW1lO1xyXG4gICAgICAgIHRoaXMuYWRkcmVzcyA9IGdvb2dsZVBsYWNlLnZpY2luaXR5O1xyXG4gICAgICAgIHRoaXMucmF0aW5nID0gZ29vZ2xlUGxhY2UucmF0aW5nO1xyXG4gICAgICAgIC8vIFVzZSBHb29nbGUgc3RyZWV0IHZpZXcgQVBJXHJcbiAgICAgICAgdGhpcy5pbWcgPSAnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL3N0cmVldHZpZXc/JyArXHJcbiAgICAgICAgICAgJ3NpemU9MzUweDI1MCZoZWFkaW5nPTE1MS43OCZwaXRjaD0tMC43NiZsb2NhdGlvbj0nICsgbG9jYXRpb24ubGF0KCkgKycsJyArIGxvY2F0aW9uLmxuZygpICtcclxuICAgICAgICAgICAnJmtleT0nICsgZ29vZ2xlTWFwc0tleTtcclxuICAgICAgICB0aGlzLnR5cGVzID0gW3R5cGVdO1xyXG4gICAgICAgIC8vIFRoaXMgaXMgdG8gYmUgZmlsbGVkIHdpdGggdGhlIHllbHAgcmVzdWx0LlxyXG4gICAgICAgIHRoaXMueWVscCA9IGtvLm9ic2VydmFibGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5tYXJrZXIgPSBudWxsO1xyXG4gICAgfTtcclxuXHJcbiAgICBQbGFjZS5wcm90b3R5cGUuc2V0TWFya2VyID0gZnVuY3Rpb24obWFya2VyKSB7XHJcbiAgICAgICAgdGhpcy5tYXJrZXIgPSBtYXJrZXI7XHJcbiAgICB9XHJcblxyXG4gICAgUGxhY2UucHJvdG90eXBlLmhhc1llbHBEYXRhID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueWVscCgpICE9IG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIGFwcC5tb2RlbHMucGxhY2UgPSBQbGFjZTtcclxufSkoKTsiLCJ2YXIgYXBwID0gYXBwIHx8IHt9O1xyXG5hcHAubW9kZWxzID0gYXBwLm1vZGVscyB8fCB7fTtcclxuXHJcbihmdW5jdGlvbigpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgUGxhY2VzTW9kZWwgPSBmdW5jdGlvbihtYXBNb2RlbCkge1xyXG4gICAgICAgIHRoaXMueWVscCA9IHtcclxuICAgICAgICAgICAgdXJsOiAnaHR0cDovL2FwaS55ZWxwLmNvbS92Mi9zZWFyY2gnLFxyXG5cclxuICAgICAgICAgICAgY29uc3VtZXJLZXk6IHllbHBDb25zdW1lcktleSxcclxuICAgICAgICAgICAgY29uc3VtZXJTZWNyZXQ6IHllbHBDb25zdW1lclNlY3JldCxcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW46IHllbHBBY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5TZWNyZXQ6IHllbHBBY2Nlc3NUb2tlblNlY3JldCxcclxuICAgICAgICAgICAgc2VydmljZVByb3ZpZGVyOiB7XHJcbiAgICAgICAgICAgICAgICBzaWduYXR1cmVNZXRob2Q6IFwiSE1BQy1TSEExXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5wbGFjZXMgPSBbXTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkUGxhY2VzID0ga28ub2JzZXJ2YWJsZUFycmF5KFtdKTtcclxuICAgICAgICB0aGlzLmN1cnJlbnRQbGFjZSA9IGtvLm9ic2VydmFibGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5tYXBNb2RlbCA9IG1hcE1vZGVsO1xyXG4gICAgfTtcclxuXHJcbiAgICBQbGFjZXNNb2RlbC5wcm90b3R5cGUuaXNQbGFjZVNlbGVjdGVkID0gZnVuY3Rpb24ocGxhY2UpIHtcclxuICAgICAgICAgcmV0dXJuIHRoaXMuaXNBbnlQbGFjZVNlbGVjdGVkKCkgJiYgcGxhY2UuaWQgPT0gdGhpcy5jdXJyZW50UGxhY2UoKS5pZDtcclxuICAgICB9O1xyXG5cclxuICAgICBQbGFjZXNNb2RlbC5wcm90b3R5cGUuaXNBbnlQbGFjZVNlbGVjdGVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQbGFjZSgpICE9IG51bGw7XHJcbiAgICAgfTtcclxuXHJcbiAgICAvLyBQZXJmb3JtIHNlYXJjaCBhbmQgZmlsdGVyIHNlbGVjdGVkUGxhY2VzXHJcbiAgICBQbGFjZXNNb2RlbC5wcm90b3R5cGUuc2VhcmNoID0gZnVuY3Rpb24oa2V5d29yZCkge1xyXG4gICAgICAgIHZhciBmaWx0ZXJlZFBsYWNlcyA9IHRoaXMucGxhY2VzO1xyXG4gICAgICAgIC8vIENsZWFyIGN1cnJlbnQgcGxhY2Ugc2VsZWN0aW9uXHJcbiAgICAgICAgdGhpcy5jdXJyZW50UGxhY2UobnVsbCk7XHJcblxyXG4gICAgICAgIC8vIEhpZGUgYWxsIHBsYWNlcyBtYXJrZXJzXHJcbiAgICAgICAgdGhpcy5wbGFjZXMuZm9yRWFjaChmdW5jdGlvbihwbGFjZSkge1xyXG4gICAgICAgICAgICBwbGFjZS5tYXJrZXIuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmKGtleXdvcmQpIHtcclxuICAgICAgICAgICAgLy8gU2VhcmNoIGZvciB0aGUga2V5d29yZFxyXG4gICAgICAgICAgICBrZXl3b3JkID0ga2V5d29yZC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICBmaWx0ZXJlZFBsYWNlcyA9IGZpbHRlcmVkUGxhY2VzLmZpbHRlcihmdW5jdGlvbihwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBsYWNlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGtleXdvcmQpID4gLTEgfHxcclxuICAgICAgICAgICAgICAgICAgICBwbGFjZS50eXBlcy5qb2luKCcgJykudG9Mb3dlckNhc2UoKS5pbmRleE9mKGtleXdvcmQpID4gLTEgfHxcclxuICAgICAgICAgICAgICAgICAgICBwbGFjZS5hZGRyZXNzLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihrZXl3b3JkKSA+IC0xO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNob3cgZmlsdGVyZWQgcGxhY2VzIG1hcmtlcnNcclxuICAgICAgICBmaWx0ZXJlZFBsYWNlcy5mb3JFYWNoKGZ1bmN0aW9uKHBsYWNlKSB7XHJcbiAgICAgICAgICAgIHBsYWNlLm1hcmtlci5zZXRWaXNpYmxlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRQbGFjZXMoZmlsdGVyZWRQbGFjZXMpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBVc2UgQWpheCBKU09OUCByZXF1ZXN0IHRvIGdldCBuZWFyIGJ5IHBsYWNlcy5cclxuICAgIC8vIFVzaW5nIEdvb2dsZSBQbGFjZXMgQVBJXHJcbiAgICBQbGFjZXNNb2RlbC5wcm90b3R5cGUubG9hZEdvb2dsZVBsYWNlcyA9IGZ1bmN0aW9uKGxhdExuZykge1xyXG4gICAgICAgIHRoaXMucGxhY2VzLnNwbGljZSgwLCB0aGlzLnBsYWNlcy5sZW5ndGgpO1xyXG4gICAgICAgIHRoaXMucGxhY2VzU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5wbGFjZXMuUGxhY2VzU2VydmljZShhcHAubWFwT2JqZWN0cy5tYXApO1xyXG4gICAgICAgIC8vIExvYWQgc3RvcmVzXHJcbiAgICAgICAgdGhpcy5fYWRkR29vZ2xlUGxhY2VzKGxhdExuZywgJ3N0b3JlJyk7XHJcbiAgICAgICAgLy8gTG9hZCBsb2RnZXNcclxuICAgICAgICB0aGlzLl9hZGRHb29nbGVQbGFjZXMobGF0TG5nLCAnbG9kZ2UnKTtcclxuICAgICAgICAvLyBMb2FkIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgdGhpcy5fYWRkR29vZ2xlUGxhY2VzKGxhdExuZywgJ3Jlc3RhdXJhbnQnKTtcclxuICAgICAgICAvLyBMb2FkIGdyb2NlcnlcclxuICAgICAgICB0aGlzLl9hZGRHb29nbGVQbGFjZXMobGF0TG5nLCAnZ3JvY2VyeScpO1xyXG4gICAgICAgIC8vIExvYWQgaG9zcGl0YWxzXHJcbiAgICAgICAgdGhpcy5fYWRkR29vZ2xlUGxhY2VzKGxhdExuZywgJ2hvc3BpdGFsJyk7XHJcbiAgICAgICAgLy8gTG9hZCBwYXJrc1xyXG4gICAgICAgIHRoaXMuX2FkZEdvb2dsZVBsYWNlcyhsYXRMbmcsICdwYXJrJyk7XHJcbiAgICB9O1xyXG5cclxuICAgIFBsYWNlc01vZGVsLnByb3RvdHlwZS5fYWRkR29vZ2xlUGxhY2VzID0gZnVuY3Rpb24obGF0TG5nLCB0eXBlKSB7XHJcbiAgICAgICAgdmFyIHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uOiBsYXRMbmcsXHJcbiAgICAgICAgICAgIGtleXdvcmQ6IHR5cGUsXHJcbiAgICAgICAgICAgIHJhZGl1czogJzUwMCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICBzZWxmLnBsYWNlc1NlcnZpY2UubmVhcmJ5U2VhcmNoKHJlcXVlc3QsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLmZvckVhY2goZnVuY3Rpb24oZ29vZ2xlUGxhY2UpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBwbGFjZSBleGlzdHMsIGFkZCBuZXcgdHlwZSBvbmx5XHJcbiAgICAgICAgICAgICAgICB2YXIgZXhpc3RpbmdQbGFjZSA9IHNlbGYucGxhY2VzLmZpbHRlcihmdW5jdGlvbihwbGFjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwbGFjZS5pZCA9PSBnb29nbGVQbGFjZS5wbGFjZV9pZDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYoZXhpc3RpbmdQbGFjZS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdQbGFjZVswXS50eXBlcy5wdXNoKHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UGxhY2UgPSBuZXcgYXBwLm1vZGVscy5wbGFjZShnb29nbGVQbGFjZSwgdHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG1hcmtlciBhbmQgYWRkIGl0IHRvIHBsYWNlXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld01hcmtlciA9IHNlbGYuX2NyZWF0ZU1hcmtlcihuZXdQbGFjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV3UGxhY2Uuc2V0TWFya2VyKG5ld01hcmtlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wbGFjZXMucHVzaChuZXdQbGFjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWxlY3RlZFBsYWNlcy5wdXNoKG5ld1BsYWNlKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBFeHRlbmQgbWFwIGJvdW5kc1xyXG4gICAgICAgICAgICAgICAgICAgIGFwcC5tYXBPYmplY3RzLmJvdW5kcy5leHRlbmQobmV3UGxhY2UubGF0TG5nKTtcclxuICAgICAgICAgICAgICAgICAgICBhcHAubWFwT2JqZWN0cy5tYXAuZml0Qm91bmRzKGFwcC5tYXBPYmplY3RzLmJvdW5kcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBQbGFjZXNNb2RlbC5wcm90b3R5cGUuX2xvYWRZZWxwRGV0YWlscyA9IGZ1bmN0aW9uKHBsYWNlKSB7XHJcbiAgICAgICAgdmFyIHRlcm1zID0gcGxhY2UubmFtZTtcclxuICAgICAgICB2YXIgbmVhciA9IHBsYWNlLmxhdExuZy5sYXQoKSArICcsJyArIHBsYWNlLmxhdExuZy5sbmcoKTtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAvLyBDb25zdHJ1Y3QgUmVxdWVzdCBQYXJhbWV0ZXJzXHJcbiAgICAgICAgdmFyIHBhcmFtZXRlcnMgPSBbXTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnB1c2goWyd0ZXJtJywgdGVybXNdKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnB1c2goWydsbCcsIG5lYXJdKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnB1c2goWydjYWxsYmFjaycsICdjYiddKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnB1c2goWydvYXV0aF9jb25zdW1lcl9rZXknLCBzZWxmLnllbHAuY29uc3VtZXJLZXldKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnB1c2goWydvYXV0aF9jb25zdW1lcl9zZWNyZXQnLCBzZWxmLnllbHAuY29uc3VtZXJTZWNyZXRdKTtcclxuICAgICAgICBwYXJhbWV0ZXJzLnB1c2goWydvYXV0aF90b2tlbicsIHNlbGYueWVscC5hY2Nlc3NUb2tlbl0pO1xyXG4gICAgICAgIHBhcmFtZXRlcnMucHVzaChbJ29hdXRoX3NpZ25hdHVyZV9tZXRob2QnLCBzZWxmLnllbHAuc2VydmljZVByb3ZpZGVyLnNpZ25hdHVyZU1ldGhvZF0pO1xyXG5cclxuICAgICAgICB2YXIgbWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgJ2FjdGlvbic6IHNlbGYueWVscC51cmwsXHJcbiAgICAgICAgICAgICdtZXRob2QnOiAnR0VUJyxcclxuICAgICAgICAgICAgJ3BhcmFtZXRlcnMnOiBwYXJhbWV0ZXJzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFjY2Vzc29yID0ge1xyXG4gICAgICAgICAgICBjb25zdW1lclNlY3JldDogc2VsZi55ZWxwLmNvbnN1bWVyU2VjcmV0LFxyXG4gICAgICAgICAgICB0b2tlblNlY3JldDogc2VsZi55ZWxwLmFjY2Vzc1Rva2VuU2VjcmV0XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgT0F1dGguc2V0VGltZXN0YW1wQW5kTm9uY2UobWVzc2FnZSk7XHJcbiAgICAgICAgT0F1dGguU2lnbmF0dXJlTWV0aG9kLnNpZ24obWVzc2FnZSwgYWNjZXNzb3IpO1xyXG4gICAgICAgIHZhciBwYXJhbWV0ZXJNYXAgPSBPQXV0aC5nZXRQYXJhbWV0ZXJNYXAobWVzc2FnZS5wYXJhbWV0ZXJzKTtcclxuICAgICAgICBwYXJhbWV0ZXJNYXAub2F1dGhfc2lnbmF0dXJlID0gT0F1dGgucGVyY2VudEVuY29kZShwYXJhbWV0ZXJNYXAub2F1dGhfc2lnbmF0dXJlKTtcclxuXHJcbiAgICAgICAgLy8gUGVyZm9ybSB0aGUgYWpheCBjYWxsLlxyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICd1cmwnOiBtZXNzYWdlLmFjdGlvbixcclxuICAgICAgICAgICAgJ2RhdGEnOiBwYXJhbWV0ZXJNYXAsXHJcbiAgICAgICAgICAgICdjYWNoZSc6IHRydWUsXHJcbiAgICAgICAgICAgICdkYXRhVHlwZSc6ICdqc29ucCcsXHJcbiAgICAgICAgICAgICdqc29ucENhbGxiYWNrJzogJ2NiJ1xyXG4gICAgICAgIH0pLmRvbmUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAvLyBUYWtlIHRoZSBmaXJzdCBvYmplY3QgaW4gdGhlIGJ1c2luZXNzZXMgYXJyYXkuXHJcbiAgICAgICAgICAgIGlmKGRhdGEuYnVzaW5lc3NlcyAmJiBkYXRhLmJ1c2luZXNzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHllbHBPYmogPSBuZXcgYXBwLm1vZGVscy55ZWxwKGRhdGEuYnVzaW5lc3Nlc1swXSk7XHJcbiAgICAgICAgICAgICAgICBwbGFjZS55ZWxwKHllbHBPYmopO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gTm8gZGF0YSBmb3VuZC4gQ3JlYXRlIE5vIGRhdGEgb2JqZWN0LlxyXG4gICAgICAgICAgICAgICAgcGxhY2UueWVscChuZXcgYXBwLm1vZGVscy55ZWxwKG51bGwpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMpIHtcclxuICAgICAgICAgICAgLy8gU2V0IHllbHAgb2JqZWN0IHdpdGggZmFpbHVyZSB0byBnZXQgZGF0YSBtZXNzYWdlXHJcbiAgICAgICAgICAgIHBsYWNlLnllbHAobmV3IGFwcC5tb2RlbHMueWVscChudWxsKSk7XHJcbiAgICAgICAgICAgIHBsYWNlLnllbHAoKS5ub0RhdGEoJ0ZhaWxlZCB0byBsb2FkIFllbHAgRGF0YScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBDcmVhdGVzIGEgbWFya2VyIGZvciB0aGUgcGxhY2Ugb2JqZWN0LlxyXG4gICAgLy8gSXQgYWxzbyBoYW5kbGVzIG1hcmtlciBhbmltYXRpb24gYW5kIGNsaWNrIGhhbmRsZXJcclxuICAgIFBsYWNlc01vZGVsLnByb3RvdHlwZS5fY3JlYXRlTWFya2VyID0gZnVuY3Rpb24ocGxhY2UpIHtcclxuICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBwbGFjZS5sYXRMbmcsXHJcbiAgICAgICAgICAgIG1hcDogYXBwLm1hcE9iamVjdHMubWFwXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLy8gU2V0IHRoZSBtYXJrZXIgaWNvbiB0byB0aGUgZmlyc3QgdHlwZVxyXG4gICAgICAgIG1hcmtlci5zZXRJY29uKCdpbWcvJyArIHBsYWNlLnR5cGVzWzBdICsgJy5wbmcnKTtcclxuICAgICAgICAvLyBBZGQgY2xpY2sgbGlzdGVuZXIgdG8gbWFya2VyXHJcbiAgICAgICAgbWFya2VyLmFkZExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAvLyBDbG9zZSB0aGUgc2lkZSBuYXZpZ2F0aW9uXHJcbiAgICAgICAgICAgIHNlbGYubWFwTW9kZWwuY2xvc2VTaWRlTmF2LmNhbGwoc2VsZi5tYXBNb2RlbCk7XHJcbiAgICAgICAgICAgIC8vIENsb3NlIEluZm9XaW5kb3cgZnJvbSBvbGQgbG9jYXRpb24gKGlmIGFueSBpcyBvcGVuKVxyXG4gICAgICAgICAgICBuZXcgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcihhcHAubWFwT2JqZWN0cy5pbmZvd2luZG93LCAnY2xvc2VjbGljaycpO1xyXG4gICAgICAgICAgICAvLyBSZWNlbnRlciB0aGUgbWFwIHRvIHRoZSBtYXJrZXJcclxuICAgICAgICAgICAgYXBwLm1hcE9iamVjdHMubWFwLnBhblRvKG1hcmtlci5nZXRQb3NpdGlvbigpKTtcclxuICAgICAgICAgICAgLy8gTG9hZCB5ZWxwIGRhdGFcclxuICAgICAgICAgICAgc2VsZi5fbG9hZFllbHBEZXRhaWxzKHBsYWNlKTtcclxuICAgICAgICAgICAgLy8gU2V0IEN1cnJlbnQgUGxhY2UgdG8gdHJpZ2dlciBiaWRuaW5nIHdpdGggY3VycmVudCBwbGFjZVxyXG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRQbGFjZShwbGFjZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBTZXQgTWFya2VyIEFuaW1hdGlvbiBmb3IgMSBzZWNvbmRcclxuICAgICAgICAgICAgLy8gVGhlbiBEaXNwbGF5IEluZm8gV2luZG93IGNvbnRlbnQuXHJcbiAgICAgICAgICAgIG1hcmtlci5zZXRBbmltYXRpb24oZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkJPVU5DRSk7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBtYXJrZXIuc2V0QW5pbWF0aW9uKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgLy8gRGlzcGxheSBJbmZvIFdpbmRvdyBDb250ZW50XHJcbiAgICAgICAgICAgICAgICBhcHAubWFwT2JqZWN0cy5pbmZvd2luZG93LnNldENvbnRlbnQoYXBwLm1hcE9iamVjdHMuaW5mb2JveC5vdXRlckhUTUwpO1xyXG4gICAgICAgICAgICAgICAgYXBwLm1hcE9iamVjdHMuaW5mb3dpbmRvdy5vcGVuKGFwcC5tYXBPYmplY3RzLm1hcCwgbWFya2VyKTtcclxuICAgICAgICAgICAgfSwgNzAwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1hcmtlcjtcclxuICAgIH07XHJcblxyXG4gICAgYXBwLm1vZGVscy5wbGFjZXNNb2RlbCA9IFBsYWNlc01vZGVsO1xyXG59KSgpOyIsInZhciBhcHAgPSBhcHAgfHwge307XHJcbmFwcC5tb2RlbHMgPSBhcHAubW9kZWxzIHx8IHt9O1xyXG5cclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBNYXBNb2RlbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuY2VudGVyID0ga28ub2JzZXJ2YWJsZShuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKDQ3LjYxNjMsIC0xMjIuMTkyKSk7XHJcbiAgICAgICAgdGhpcy5zdHlsZXMgPSBrby5vYnNlcnZhYmxlKGFwcC5tb2RlbHMubWFwU3R5bGVzLmdyYXlzY2FsZSk7XHJcbiAgICAgICAgdGhpcy5wbGFjZXMgPSBuZXcgYXBwLm1vZGVscy5wbGFjZXNNb2RlbCh0aGlzKTtcclxuICAgICAgICAvLyBJbmRpY2F0ZXMgaWYgdGhlIHNpZGVOYXYgc2hvdWxkIGJlIHZpc2libGUgb3Igbm90LlxyXG4gICAgICAgIHRoaXMuc2lkZU5hdlZpc2libGUgPSBrby5vYnNlcnZhYmxlKGZhbHNlKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gUGVyZm9ybSBzZWFyY2ggYW5kIHJlc3VsdCBmaWx0ZXJhdGlvbi5cclxuICAgIE1hcE1vZGVsLnByb3RvdHlwZS5zZWFyY2ggPSBmdW5jdGlvbihrZXl3b3JkKSB7XHJcbiAgICAgICAgLy8gUGFzcyB0aGUgc2VhcmNoIHRvIHRoZSBwbGFjZXNNb2RlbFxyXG4gICAgICAgIHRoaXMucGxhY2VzLnNlYXJjaChrZXl3b3JkKTtcclxuICAgIH07XHJcblxyXG4gICAgTWFwTW9kZWwucHJvdG90eXBlLm9wZW5TaWRlTmF2ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2VmlzaWJsZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBNYXBNb2RlbC5wcm90b3R5cGUuY2xvc2VTaWRlTmF2ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5zaWRlTmF2VmlzaWJsZShmYWxzZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU3BlY2lmeSB0aGUgbWFwIGluaXRpYWxpemF0aW9uIG9wdGlvbnNcclxuICAgIGFwcC5tb2RlbHMubWFwTW9kZWwgPSBNYXBNb2RlbDtcclxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
